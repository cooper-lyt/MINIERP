INSERT INTO DG_SYSTEM.SYSTEM_PARAM(ID,TYPE,VALUE,MEMO) VALUES('erp.finance.useAdvance','BOOLEAN','false','使用预收货款');

-- oper

-- DEPOSIT_BACK

UPDATE MINI_ERP.ACCOUNT_OPER SET  ACCOUNTS_RECEIVABLE = ADVANCE_RECEIVABLE WHERE OPER_TYPE = 'DEPOSIT_BACK';

UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'DEPOSIT_BACK';

UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'ORDER_BACK';

UPDATE MINI_ERP.ACCOUNT_OPER SET ACCOUNTS_RECEIVABLE = ACCOUNTS_RECEIVABLE + ADVANCE_RECEIVABLE WHERE OPER_TYPE = 'CUSTOMER_SAVINGS';
UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'CUSTOMER_SAVINGS';

DELETE FROM MINI_ERP.ACCOUNT_OPER WHERE OPER_TYPE = 'DEPOSIT_PAY';

UPDATE MINI_ERP.ACCOUNT_OPER SET ACCOUNTS_RECEIVABLE = ACCOUNTS_RECEIVABLE + ADVANCE_RECEIVABLE WHERE OPER_TYPE = 'ORDER_PAY';
UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'ORDER_PAY';


UPDATE MINI_ERP.CUSTOMER SET ACCOUNT_MONEY = ACCOUNT_MONEY - ADVANCE_MONEY;

UPDATE MINI_ERP.CUSTOMER SET ADVANCE_MONEY = 0;



CREATE TABLE MINI_ERP.RES_SALE_REBATE
(
  ID VARCHAR(32) NOT NULL COMMENT 'ID',
  CUSTOMER_ORDER VARCHAR(32) NOT NULL COMMENT '订单',
  RES VARCHAR(32) NOT NULL COMMENT 'RES',
  RES_UNIT VARCHAR(32) NOT NULL COMMENT 'RES_UNIT',
  PRICE DECIMAL(19,4) NOT NULL COMMENT '单价',
  COUNT DECIMAL(19,4) NOT NULL COMMENT 'COUNT',
  MONEY DECIMAL(19,3) NOT NULL COMMENT '金额',
  REBATE_BASIC_COUNT DECIMAL(19,4) NOT NULL COMMENT '反点基数',
  REBATE_RATE_COUNT DECIMAL(19,4) NOT NULL COMMENT '返点数',
  REBATE_COUNT DECIMAL(19,4) NOT NULL COMMENT '返点数量',
  REBATE_MONEY DECIMAL(19,4) NOT NULL COMMENT '返点金额',
  MEMO VARCHAR(200) COMMENT '备注',
  PRIMARY KEY (ID)
) ENGINE = InnoDB COMMENT = '物质销售返点' DEFAULT CHARACTER SET utf8;

ALTER TABLE MINI_ERP.RES_SALE_REBATE
ADD FOREIGN KEY (RES)
REFERENCES MINI_ERP.RES (ID)
  ON UPDATE RESTRICT
  ON DELETE RESTRICT
;

ALTER TABLE MINI_ERP.RES_SALE_REBATE
ADD FOREIGN KEY (CUSTOMER_ORDER)
REFERENCES MINI_ERP.CUSTOMER_ORDER (ID)
  ON UPDATE RESTRICT
  ON DELETE RESTRICT
;



-- res  | ff808081463381b901463ddbaa581e84 |  | T管



UPDATE MINI_ERP.RES SET CATEGORY = 'ff808081463381b901463dd51c111e83' where ID='ff8080814389c45401438a1a8bbe001a';
UPDATE MINI_ERP.RES SET CATEGORY = 'ff808081463381b901463dd51c111e83' where ID='ff8080814389c45401438a1eebed001d';


UPDATE MINI_ERP.RES SET CATEGORY = 'ff808081463381b901463dd4eb211e82' where ID='ff8080814389c45401438a22b0fa0020';

UPDATE MINI_ERP.RES SET NAME = 'A管',CODE='GA' where ID='ff8080814389c45401438a22b0fa0020';




 -- ff8080814389c45401438a14e6e50013 | T    | T

-- | ff80808144f9b2b70144ff575c19007a | THP  | T黄牌

-- | ff80808144f9b2b70144ff57b2ba007b | TEJP | T二级品

-- | ff80808144f9b2b70144ff5811a5007c | TSJP | T三级品


INSERT DG_SYSTEM.WORD_CATEGORY(ID, NAME, MEMO, SYSTEM) VALUES('black.add.g.t','T管类别','T管类别',b'0');

UPDATE MINI_ERP.FORMAT_DEFINE SET  WORD_CATEGORY_ID = 'black.add.g.t'  WHERE ID='ff808081463381b901463ddbaa581e87';

UPDATE DG_SYSTEM.WORD_CATEGORY set NAME='A管类别' where ID = 'ff8080814389c45401438a14aa0c0011';

UPDATE DG_SYSTEM.WORD SET _VALUE ='一级品',CATEGORY='black.add.g.t' where ID='ff8080814389c45401438a14e6e50013';

UPDATE DG_SYSTEM.WORD SET _VALUE ='二级品',CATEGORY='black.add.g.t' where ID='ff80808144f9b2b70144ff57b2ba007b';

UPDATE DG_SYSTEM.WORD SET _VALUE ='三级品',CATEGORY='black.add.g.t' where ID='ff80808144f9b2b70144ff5811a5007c';

UPDATE DG_SYSTEM.WORD SET _VALUE ='黄牌',CATEGORY='black.add.g.t' where ID='ff80808144f9b2b70144ff575c19007a';


UPDATE MINI_ERP.STORE_RES SET RES = 'ff808081463381b901463ddbaa581e84' WHERE ID IN (
select DISTINCT FORMAT.STORE_RES from MINI_ERP.FORMAT left join MINI_ERP.FORMAT_DEFINE on DEFINE = FORMAT_DEFINE.ID left join DG_SYSTEM.WORD sd on sd.ID = FORMAT.FORMAT_VALUE  where FORMAT_DEFINE.WORD_CATEGORY_ID ='ff8080814389c45401438a14aa0c0011' and sd.CATEGORY = 'black.add.g.t');

UPDATE MINI_ERP.FORMAT left join MINI_ERP.STORE_RES on FORMAT.STORE_RES = STORE_RES.ID
SET DEFINE = 'ff808081463381b901463ddbaa581e87'
WHERE STORE_RES.RES = 'ff808081463381b901463ddbaa581e84' AND DEFINE = 'ff8080814389c45401438a22b0fa0023';

UPDATE MINI_ERP.FORMAT left join MINI_ERP.STORE_RES on FORMAT.STORE_RES = STORE_RES.ID
SET DEFINE = 'ff808081463381b901463ddbaa581e86' WHERE STORE_RES.RES = 'ff808081463381b901463ddbaa581e84' AND DEFINE = 'ff8080814389c45401438a22b0fa0021';

UPDATE MINI_ERP.FORMAT left join MINI_ERP.STORE_RES on FORMAT.STORE_RES = STORE_RES.ID
SET DEFINE = 'ff808081463381b901463ddbaa581e85' WHERE STORE_RES.RES = 'ff808081463381b901463ddbaa581e84' AND DEFINE = 'ff8080814389c45401438a22b0fa0022';




-- delete and replace   ff80808144f9b2b701450c080a78023a  A|  二级品 | 壁厚 20*1.9 | 150米/捆
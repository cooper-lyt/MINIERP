INSERT INTO DG_SYSTEM.SYSTEM_PARAM(ID,TYPE,VALUE,MEMO) VALUES('erp.finance.useAdvance','BOOLEAN','false','使用预收货款');

-- oper

-- DEPOSIT_BACK

UPDATE MINI_ERP.ACCOUNT_OPER SET  ACCOUNTS_RECEIVABLE = ADVANCE_RECEIVABLE WHERE OPER_TYPE = 'DEPOSIT_BACK';

UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'DEPOSIT_BACK';

UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'ORDER_BACK';

UPDATE MINI_ERP.ACCOUNT_OPER SET ACCOUNTS_RECEIVABLE = ACCOUNTS_RECEIVABLE + ADVANCE_RECEIVABLE WHERE OPER_TYPE = 'CUSTOMER_SAVINGS';
UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'CUSTOMER_SAVINGS';

DELETE FROM MINI_ERP.ACCOUNT_OPER WHERE OPER_TYPE = 'DEPOSIT_PAY';

UPDATE MINI_ERP.ACCOUNT_OPER SET ACCOUNTS_RECEIVABLE = ACCOUNTS_RECEIVABLE + ADVANCE_RECEIVABLE WHERE OPER_TYPE = 'ORDER_PAY';
UPDATE MINI_ERP.ACCOUNT_OPER SET ADVANCE_RECEIVABLE = 0 WHERE OPER_TYPE = 'ORDER_PAY';


UPDATE MINI_ERP.CUSTOMER SET ACCOUNT_MONEY = ACCOUNT_MONEY - ADVANCE_MONEY;

UPDATE MINI_ERP.CUSTOMER SET ADVANCE_MONEY = 0;
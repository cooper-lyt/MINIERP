<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.org/schema/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:a="http://richfaces.org/a4j"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.org/rich">


<s:decorate template="/layout/erp/publicOrderInfo.xhtml">

</s:decorate>


<a:outputPanel
        rendered="#{s:hasRole('erp.sale.manager') or s:hasRole('erp.finance.accountancy') or s:hasRole('erp.finance.cashier') or s:hasRole(orderHome.instance.customer.customerArea.role)}">

    <s:decorate template="/layout/view-details.xhtml">
        <ui:include src="/layout/erp/CustomerView.xhtml">

            <ui:param name="customer" value="#{orderHome.instance.customer}"/>

        </ui:include>
        <ui:param name="labelValue" value="#{orderHome.instance.customer.name}"/>
        <ui:param name="openLabel" value="#{messages.Customer}"/>
        <ui:param name="hideLabel" value="#{messages.detailsHide}#{' '}#{messages.Customer}"/>
    </s:decorate>


    <s:decorate template="/layout/seam-display.xhtml">
        <ui:define name="label">#{messages.order_field_contact}</ui:define>
        <h:outputText value="#{orderHome.instance.contact}"/>
    </s:decorate>

    <s:decorate template="/layout/seam-display.xhtml">
        <ui:define name="label">#{messages.order_field_tel}</ui:define>
        <h:outputText value="#{orderHome.instance.tel}"/>
    </s:decorate>


</a:outputPanel>

<a:outputPanel rendered="#{s:hasRole('erp.sale.manager')}">

    <div style="clear: both;"/>


    <s:decorate template="/layout/seam-display.xhtml" rendered="#{not empty orderHome.instance.middleTotal}">
        <ui:define name="label"><h:selectBooleanCheckbox disabled="true"
                                                         value="#{orderHome.instance.includeMiddleMan}"/>#{messages.includeMiddleMan}
        </ui:define>

        [#{messages.order_field_middleMoney}]
        <h:outputText value="#{orderHome.instance.middleTotal}">
            <f:convertNumber type="currency" locale="#{calendarBean.locale}"/>
        </h:outputText>  #{' '}=#{' '}
        <a:outputPanel rendered="#{not (orderHome.instance.middleMoneyCalcType eq 'NOT_CALC')}">
            [#{messages.orderMiddleMoney}]<h:outputText value="#{orderHome.instance.middleMoney}">
            <f:convertNumber type="currency" locale="#{calendarBean.locale}"/>
        </h:outputText>
            (

            <a:outputPanel rendered="#{orderHome.instance.middleMoneyCalcType eq 'TOTAL_MONEY_RATE'}">
                #{' '}=#{' '}
                <h:outputText value="#{orderHome.instance.money}">
                    <f:convertNumber type="currency" locale="#{calendarBean.locale}"/>
                </h:outputText>
                #{' '} * #{' '}%#{' '}
                <h:outputText value="#{orderHome.instance.middleRate}">
                    <f:convertNumber pattern="#0.####"/>
                </h:outputText>
            </a:outputPanel>

            )  #{' '}+#{' '} [#{messages.orderItemMiddleMoney}]
            <h:outputText value="#{orderHome.totalItemMiddleMoney}">
                <f:convertNumber type="currency" locale="#{calendarBean.locale}"/>
            </h:outputText>


        </a:outputPanel>
    </s:decorate>

</a:outputPanel>

<a:outputPanel
        rendered="#{s:hasRole('erp.sale.manager') or s:hasRole(orderHome.instance.customer.customerArea.role) or s:hasRole('erp.finance.accountancy') or s:hasRole('erp.finance.cashier') }">
    <s:decorate template="/layout/seam-display.xhtml">
        <ui:define name="label">
            <h:selectBooleanCheckbox disabled="true" value="#{orderHome.instance.earnestFirst}"/>
            #{messages.order_field_earnestFirst}</ui:define>

        <a:outputPanel rendered="#{orderHome.instance.earnestFirst and (not empty orderHome.instance.earnest)}">
            <h:outputText value="#{orderHome.instance.earnest}">
                <f:convertNumber type="currency" locale="#{calendarBean.locale}"/>
            </h:outputText>
        </a:outputPanel>

    </s:decorate>

    <s:decorate template="/layout/seam-display.xhtml">
        <ui:define name="label">#{messages.orderSaleMoney}</ui:define>
        <h:outputText value="#{orderHome.instance.money}">
            <f:convertNumber type="currency" locale="#{calendarBean.locale}"/>
        </h:outputText>
        #{' '} = #{' '}
        [#{messages.storeResMoney}]
        <h:outputText value="#{orderHome.instance.resMoney}">
            <f:convertNumber type="currency" locale="#{calendarBean.locale}"/>
        </h:outputText>
        #{' '} * #{' '}[#{messages.orderRebate}]
        <h:outputText value="#{orderHome.instance.totalRebate}">
            <f:convertNumber pattern="#0.##"/>
        </h:outputText>

    </s:decorate>
</a:outputPanel>

<br/>



<a:outputPanel
        rendered="#{s:hasRole('erp.sale.manager') or s:hasRole('erp.storage.dispatch') or s:hasRole(orderHome.instance.customer.customerArea.role)}">

    <ui:include src="/layout/erp/OrderItemTable.xhtml">
        <ui:param name="orderItems" value="#{orderHome.allCompleteOrderItem}"/>
        <ui:param name="totalItemMoney" value="#{orderHome.completeOrderItemMoney}"/>
    </ui:include>
    <br/>

    <rich:dataTable style="width: 100%" value="#{allShipStoreResEntrySet}" var="_entry">
        <f:facet name="header">
            <rich:columnGroup>
                <rich:column rowspan="2" breakRowBefore="true">
                    #{messages.StoreRes}
                </rich:column>
                <rich:column colspan="2">
                    #{messages.storeOutCount}
                </rich:column>
                <rich:column breakRowBefore="true">
                    #{messages.MasterUnitCount}
                </rich:column>
                <rich:column>
                    #{messages.AuxUnitCount}
                </rich:column>
            </rich:columnGroup>
        </f:facet>

        <rich:column>
            <ui:include src="/layout/erp/StoreResTitle.xhtml">
                <ui:param name="storeRes" value="#{_entry.key}"/>
            </ui:include>

        </rich:column>

        <rich:column>
            #{_entry.value.displayMasterCount}
        </rich:column>

        <rich:column>
            #{_entry.value.displayAuxCount}
        </rich:column>
    </rich:dataTable>


    <a:repeat value="#{orderHome.instance.needResList}" var="_needRes">
        <br/>
        <rich:panel>
            <f:facet name="header">
                #{messages[_needRes.type.name()]}
            </f:facet>
            <ui:include src="/layout/erp/orderNeedResInfo.xhtml">
                <ui:param name="needRes" value="#{_needRes}"/>
            </ui:include>


            <a:repeat value="#{_needRes.dispatchList}" var="_dispatch">

                <div style="clear: both"/>
                <s:decorate template="/layout/view-details.xhtml">
                    <ui:param name="openLabel"
                              value="#{messages.dispatch_field_store}"/>
                    <ui:param name="hideLabel"
                              value="#{messages.detailsHide}#{' '}#{messages.dispatch_field_store}"/>

                    <ui:param name="labelValue" value="#{_dispatch.store.name}"/>
                    <ui:include src="/layout/erp/orderDispatchInfo.xhtml">
                        <ui:param name="dispatch" value="#{_dispatch}"/>
                    </ui:include>
                </s:decorate>
            </a:repeat>
            <br/>

            <div style="clear: both"/>
        </rich:panel>

    </a:repeat>


    <div style="clear: both"/>


    
</a:outputPanel>

<a:outputPanel
        rendered="#{s:hasRole('erp.sale.manager') or s:hasRole('erp.finance.accountancy') or s:hasRole('erp.finance.cashier')}">
    <br/>
    <ui:include src="/layout/erp/OrderPayRecord.xhtml">
        <ui:param name="order" value="#{orderHome.instance}"/>

    </ui:include>


    <br/>
    <rich:dataTable style="width: 100%" value="#{orderHome.instance.orderFeeList}" var="_fee"
                    noDataLabel="#{messages.orderFee_empty}">

        <f:facet name="header">
            #{messages.orderOrderFeePay}
        </f:facet>
        <rich:column>
            <f:facet name="header">#{messages.orderFee_field_receiveName}</f:facet>

            #{_fee.receiveName}


            <f:facet name="footer">
                #{messages.recordTotal} #{orderHome.instance.orderFeeList.size} #{messages.item}
            </f:facet>
        </rich:column>
        <rich:column>
            <f:facet name="header">#{messages.description}</f:facet>
            #{_fee.description}
        </rich:column>

        <rich:column>
            <f:facet name="header">#{messages.orderFee_field_payType}</f:facet>
            <a:outputPanel>
                <rich:tooltip followMouse="false" showDelay="1000" styleClass="tooltip-custom-body"
                              layout="block">
                    <span style="white-space: nowrap">#{messages.orderFee_field_receiveInfo}:#{_fee.receiveInfo}</span>
                    <br/>

                    <s:span style="white-space: nowrap" rendered="#{_fee.payType eq 'BANK_TRANSFER'}">
                        #{messages.bank}: #{dictionary.getWordValue(_fee.bank)}</s:span>
                    <br/>

                    <s:span style="white-space: nowrap" rendered="#{_fee.payType eq 'BANK_TRANSFER'}">
                        #{messages.orderFee_field_bankNumber}: #{_fee.bankNumber}</s:span>

                    <br/>

                    <s:span style="white-space: nowrap" rendered="#{_fee.payType eq 'BANK_TRANSFER'}">
                        #{messages.orderFee_field_bankInfo}: #{_fee.bankInfo}</s:span>

                    <br/>


                </rich:tooltip>

                #{messages[_fee.payType.name()]}
            </a:outputPanel>
        </rich:column>

        <rich:column style="text-align: right">
            <f:facet name="header">#{messages.orderFee_field_money}</f:facet>
            <h:outputText value="#{_fee.money}">
                <f:convertNumber locale="#{calendarBean.locale}"
                                 type="currency"/>
            </h:outputText>

            <f:facet name="footer">
                <h:outputText value="#{orderHome.totalOrderFeeMoney}">
                    <f:convertNumber locale="#{calendarBean.locale}"
                                     type="currency"/>
                </h:outputText>
            </f:facet>
        </rich:column>

    </rich:dataTable>
</a:outputPanel>

</ui:composition>